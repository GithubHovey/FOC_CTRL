# FOC控制上位机需求文档

## 1. 项目概述
本项目旨在使用Qt Quick技术开发一款全新的FOC电机控制上位机软件，实现电机参数监控、控制和数据可视化功能，提供优秀的用户体验和操作便捷性。

## 1.1 协议基本格式说明
- **协议包长度**：固定14字节
- **校验和计算**：前12字节（字节0到字节11）的累加和
- **应答格式**：与请求格式相同
- **详细包结构**：
  - 字节0：包头（固定值0xAA）
  - 字节1：命令字（如写数据0x01、读数据0x02等）
  - 字节2-11：数据区（10字节）
  - 字节12：校验和（前12字节累加和）
  - 字节13：包尾（固定值0x55）

## 2. 功能需求

### 2.1 串口通信模块
- **串口选择与参数配置**：COM口、波特率
- **连接/断开串口功能**
- **实时显示连接状态**
- **数据显示**：
  - 将发送数据和接收数据整合到一个窗口中
  - 数据以HEX格式显示
  - 使用不同颜色区分发送数据和接收数据
  - 提供显示开关：可以单独控制是否显示TX（发送）数据或RX（接收）数据
- **支持原始数据显示切换**
- **提供发送数据输入框和发送按钮**
- **提供清空功能**

### 2.2 FOC数据曲线显示与控制
- **自定义变量添加**：用户可自行添加需要显示的变量，最多支持10个变量
- **变量参数配置**：支持为每个变量设置增益和偏置，变量初始值为0
- **自动颜色分配**：添加变量时自动分配唯一颜色，确保不同变量曲线颜色不重复
- **推荐颜色方案**：提供10种不同的颜色（如：#FF0000红色、#00FF00绿色、#0000FF蓝色、#FFFF00黄色、#FF00FF紫色、#00FFFF青色、#FFA500橙色、#800080紫色、#008000深绿色、#000080深蓝色）
- **曲线实时显示**：添加变量后，曲线立即在曲线图中显示
- **视窗操作功能**：
  - 支持视窗移动操作
  - 支持以鼠标为中心进行缩放
- **坐标轴设置**：
  - x轴范围动态调整（适应实时数据的无限延伸）
  - y轴默认范围为-10000到10000，支持手动修改
- **数据管理**：
  - 曲线选择显示功能
  - 曲线数据导出功能
  - 曲线清空、暂停功能
- **可显示的变量列表**：
  - U相电流目标值
  - U相电流当前值
  - V相电流目标值
  - V相电流当前值
  - W相电流目标值
  - W相电流当前值
  - 转速目标值
  - 转速当前值
  - Q轴电压目标值
  - Q轴电压当前值
  - D轴电压目标值
  - D轴电压当前值
  - 最大电流限制
  - 电机母线电压
  - 电机极对数
  - 电角度目标值
  - 电角度当前值
  - 机械角度目标值
  - 机械角度当前值
  - 控制模式
  - 接口模式
  - 工作状态
  - 力矩环PID Kp参数
  - 力矩环PID Ki参数
  - 力矩环PID Kd参数
  - 速度环PID Kp参数
  - 速度环PID Ki参数
  - 速度环PID Kd参数
  - 位置环PID Kp参数
  - 位置环PID Ki参数
  - 位置环PID Kd参数
  - 电流环执行时间
  - CAN ID号
  - 机械零位角度
  - 霍尔X轴直流偏移
  - 霍尔Y轴直流偏移
  - 霍尔校准状态
  - 速度环执行时间
  - 位置环执行时间

### 2.3 电机模式控制模块
- **多种控制模式切换**：支持力矩模式、速度模式、位置模式等
- **模式参数调节**：
  - **力矩模式**：力矩大小调节范围为0~100%，同时支持滑块和输入框两种调节方式
  - **速度模式**：速度大小调节范围为0~100%，同时支持滑块和输入框两种调节方式
  - **位置模式**：位置调节范围为0~360度，同时支持滑块和输入框两种调节方式
- **参数同步功能**：滑块和输入框的参数值必须保持实时同步，确保操作一致性
- **使能开关**：提供统一的模式使能开关，开关图标可以用类似播放和暂停按键，控制电机是否按当前设置运行
- **模式切换自动取消使能**：每次切换控制模式时，使能开关自动取消（置为关闭状态），需重新手动使能才能让电机按新模式运行

### 2.4 电机变量读写
- **数据ID选择**：提供完整的数据ID列表供用户选择
- **数据类型选择**：如float等
- **读取/写入数据功能**：支持对电机各项参数进行读写操作
- **执行结果显示**：显示操作的成功/失败状态及返回值
- **支持读写的数据项**：
  - U相电流目标值
  - U相电流当前值
  - V相电流目标值
  - V相电流当前值
  - W相电流目标值
  - W相电流当前值
  - 转速目标值
  - 转速当前值
  - Q轴电压目标值
  - Q轴电压当前值
  - D轴电压目标值
  - D轴电压当前值
  - 最大电流限制
  - 电机母线电压
  - 电机极对数
  - 电角度目标值
  - 电角度当前值
  - 机械角度目标值
  - 机械角度当前值
  - 控制模式
  - 接口模式
  - 工作状态
  - 力矩环PID Kp参数
  - 力矩环PID Ki参数
  - 力矩环PID Kd参数
  - 速度环PID Kp参数
  - 速度环PID Ki参数
  - 速度环PID Kd参数
  - 位置环PID Kp参数
  - 位置环PID Ki参数
  - 位置环PID Kd参数
  - 电流环执行时间
  - CAN ID号
  - 机械零位角度
  - 霍尔X轴直流偏移
  - 霍尔Y轴直流偏移
  - 霍尔校准状态
  - 速度环执行时间
  - 位置环执行时间

### 2.5 日志系统
- 系统日志记录与显示：支持日志分级功能，包括但不限于Debug、Info、Warning、Error等级别
- 右上角日志入口：当出现Error级别的日志时，右上角会显示红色数字提示当前存在的Error数量
- 支持查看不同级别的日志记录，方便用户快速定位问题

## 3. 界面设计需求

### 3.1 整体布局
- 系统采用5个独立窗口的模块化设计，每个功能模块对应一个独立窗口
- **FOC数据曲线显示与控制窗口**：作为核心窗口，默认占据最大显示空间（约占界面60%），支持最大化显示
- **串口通信窗口**：独立窗口，用于串口配置和数据收发
- **电机模式控制窗口**：独立窗口，用于控制模式切换和参数调节
- **电机变量读写窗口**：独立窗口，用于变量读写操作
- **日志系统窗口**：独立窗口，用于日志查看和管理，同时在主界面右上角显示Error数量提示
- 各窗口布局紧密，不可自由拖动，但支持调整窗口大小，保持界面整体美观与操作便捷性，重点突出曲线图像显示区域的可视性和操作便捷性

### 3.2 颜色方案
- 采用暗色主题风格（#1E1E1E作为背景色）
- 发送数据和接收数据使用不同颜色区分（如发送数据用蓝色，接收数据用绿色）
- 曲线采用不同颜色标识（如相电流A红色、相电流B黄色、相电流C绿色等）
- 重要状态使用醒目的颜色（如连接按钮使用红色表示断开状态）

### 3.3 交互设计
- 按钮点击反馈明显
- 滑块调节流畅
- 下拉菜单选择便捷
- 文本输入区域清晰可辨
- 日志入口明显且易于点击

## 4. 技术要求
- 基于Qt Quick开发
- 窗口分辨率保持720p
- 程序名称为"FOC CTRL"
- 确保中文显示正常
- 代码结构清晰，便于维护和扩展

## 5. 性能要求
- 曲线绘制流畅，无明显卡顿
- 串口数据实时显示，响应迅速
- 资源占用合理，内存使用控制在可接受范围内

## 6. 后续扩展可能性
- 支持更多电机参数的监控与控制
- 数据导出格式多样化
- 增加数据保存与历史查询功能
- 支持多机控制

---
文档版本：v1.0
创建日期："+new Date().toLocaleDateString('zh-CN')+"